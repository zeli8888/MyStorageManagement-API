package ze.mystoragemanagement.service.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import ze.mystoragemanagement.exception.IngredientNotFoundException;
import ze.mystoragemanagement.model.Dish;
import ze.mystoragemanagement.model.DishIngredient;
import ze.mystoragemanagement.model.Ingredient;
import ze.mystoragemanagement.repository.DishIngredientRepository;
import ze.mystoragemanagement.repository.DishRepository;
import ze.mystoragemanagement.repository.IngredientRepository;
import ze.mystoragemanagement.service.IngredientService;

import java.util.HashSet;
import java.util.List;
import java.util.Optional;

/**
 * @Author : Ze Li
 * @Date : 12/02/2025 19:24
 * @Version : V1.0
 * @Description :
 */

@Service
public class git IngredientServiceImpl implements IngredientService {
    @Autowired
    private IngredientRepository ingredientRepository;
    @Autowired
    private DishIngredientRepository dishIngredientRepository;

    @Override
    public List<Ingredient> getAllIngredients() {
        return ingredientRepository.findAll();
    }

    @Override
    public Ingredient getIngredientById(Long id) {
        return ingredientRepository.findById(id).orElse(null);
    }

    @Override
    public Ingredient getIngredientByName(String ingredientName) {
        return ingredientRepository.findIngredientByIngredientName(ingredientName).orElse(null);
    }

    @Override
    public void deleteIngredient(Long id) {
//        Ingredient ingredient = ingredientRepository.findById(id).orElseThrow(()->new IngredientNotFoundException(id.toString()));
//        if (ingredient.getDishes() != null) {
//            for (Dish dish : ingredient.getDishes()) {
//                dish.getDishIngredients().remove(ingredient);
//                // still work without dishRepository.save, may be because CascadeType.REFRESH
////                dishRepository.save(dish);
//            }
//        }



//        Ingredient ingredient = ingredientRepository.findById(id).orElseThrow(()->new IngredientNotFoundException(id.toString()));
//        if (ingredient.getDishIngredients() != null) {
//            for (DishIngredient dishIngredient : ingredient.getDishIngredients()) {
//                dishIngredient.getDish().getDishIngredients().remove(dishIngredient);
//                dishIngredientRepository.deleteById(dishIngredient.getDishIngredientId());
//            }
//        }
        ingredientRepository.deleteById(id);
    }

    @Override
    public Ingredient createIngredient(Ingredient ingredient) {
        return ingredientRepository.save(ingredient);
    }

    @Override
    public Ingredient updateIngredient(Long ingredientId, Ingredient ingredient) {
        ingredient.setIngredientId(ingredientId);
        return ingredientRepository.save(ingredient);
    }
}
